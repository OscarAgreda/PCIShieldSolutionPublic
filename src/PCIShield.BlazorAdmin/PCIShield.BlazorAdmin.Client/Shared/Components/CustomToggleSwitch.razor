@* CustomToggleSwitch.razor *@
@namespace PCIShield.BlazorAdmin.Client.Shared.Components
@typeparam T

@using System.Reactive.Linq
@using System.Reactive.Subjects
@using MudBlazor.Utilities
@using System.Reactive.Disposables
@implements IAsyncDisposable

<MudSwitch T="T"
           Value="@Value"
           ValueChanged="@OnValueChanged"
           Label="@Label"
           Disabled="@Disabled"
           Dense="@Dense"
           Color="@Color"
           Immediate="true"
           Class="@GetSwitchClass()"
           LabelPosition="@LabelPosition">
    <ChildContent>
        <div class="d-flex gap-4">
            <span class="@GetLabelClass(true)">@TrueLabel</span>
            <span class="@GetLabelClass(false)">@FalseLabel</span>
        </div>
    </ChildContent>
</MudSwitch>

@code {
    private readonly CompositeDisposable _disposables = new();

    [Parameter] public T Value { get; set; }
    [Parameter] public EventCallback<T> ValueChanged { get; set; }
    [Parameter] public string Label { get; set; }
    [Parameter] public string TrueLabel { get; set; } = "Yes";
    [Parameter] public string FalseLabel { get; set; } = "No";
    [Parameter] public bool Dense { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public Color Color { get; set; } = Color.Primary;
    [Parameter] public Position LabelPosition { get; set; } = Position.End;

    private async Task OnValueChanged(T value)
    {
        Value = value;
        if (ValueChanged.HasDelegate)
            await ValueChanged.InvokeAsync(value);
    }

    private string GetSwitchClass()
    {
        return new CssBuilder("custom-radio-switch")
            .AddClass("dense", Dense)
            .AddClass("disabled", Disabled)
            .Build();
    }

    private string GetLabelClass(bool isTrue)
    {
        return new CssBuilder("custom-label")
            .AddClass("selected", isTrue ? IsTrue() : !IsTrue())
            .AddClass("disabled", Disabled)
            .Build();
    }

    private bool IsTrue()
    {
        if (Value == null)
            return false;

        if (typeof(T) == typeof(bool))
            return (bool)(object)Value;

        return EqualityComparer<T>.Default.Equals(Value, (T)(object)true);
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();

        // If value is null, default to false for boolean type
        if (Value == null && typeof(T) == typeof(bool))
        {
            Value = (T)(object)false;
        }
    }

    public async ValueTask DisposeAsync()
    {
        try { _disposables.Dispose(); } catch { }
    }
}

<style>
    .custom-radio-switch {
        .mud-switch

    {
        display: flex;
        gap: 1rem;
        margin: 0;
        .mud-switch-span

    {
        display: none; /* Hides the entire switch element */
    }

    }

    .custom-label {
        display: inline-flex;
        align-items: center;
        padding: var(--mud-spacing-2);
        min-width: 120px;
        justify-content: center;
        border-radius: var(--mud-default-borderradius);
        border: 1px solid var(--mud-palette-lines-default);
        background-color: var(--mud-palette-background);
        cursor: pointer;
        &.selected

    {
        background-color: var(--mud-palette-primary);
        color: var(--mud-palette-primary-text);
    }

    &:hover:not(.disabled):not(.selected) {
        background-color: var(--mud-palette-action-default-hover);
    }

    }
    }
</style>