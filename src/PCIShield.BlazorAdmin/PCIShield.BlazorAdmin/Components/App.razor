<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />

    <link rel="stylesheet" href="css/mainLayout.css" />
    <link rel="stylesheet" href="css/navMenu.css" />
    <link rel="stylesheet" href="css/appBar.css" />

    @* PAGES STYLES *@
   @*  <link rel="stylesheet" href="css/entities.css" /> *@

    @* COMPONENTS STYLES *@
    <link rel="stylesheet" href="css/Components/CustomDialog.css" />
    <link rel="stylesheet" href="css/Components/CustomTable.css" />
    <link rel="stylesheet" href="css/Components/CustomTab.css" />
    <link rel="stylesheet" href="css/Components/CustomList.css" />
    <link rel="stylesheet" href="css/Components/PageImport.css" />

      

   @*  <link rel="stylesheet" href="app.css" /> *@

    <link rel="icon" type="image/png" href="favicon.png" />

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />


    <link href="css/gamma/pcishield-theme-gamma.css" rel="stylesheet" />
@*     <link href="css/gamma/58c1ba2fb125b215.css" rel="stylesheet" />
    <link href="css/gamma/72e6bd34f2e6555b.css" rel="stylesheet" />
    <link href="css/gamma/b5a90e0a7dc2ea97.css" rel="stylesheet" />
    <link href="css/gamma/ca0d3df61c6fc2de.css" rel="stylesheet" />
    <link href="css/gamma/e3b2f9074ebe7be2.css" rel="stylesheet" />
    <link href="css/gamma/fa26114b5c97e6cd.css" rel="stylesheet" /> *@


    <link rel="stylesheet" href="css/pciShield/pciShield-Liquid-Glass.css" />
    <link rel="stylesheet" href="css/pciShield/pciShield-theme.css" />
    <link rel="stylesheet" href="css/pciShield/pciShield-theme-auto.css" />
    <link rel="stylesheet" href="css/pciShield/pciShield-theme-md-grid.css" />

    <link rel="stylesheet" href="css/pciShield/pciShield-theme-2.css" />
 


    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    @* <link href="_content/MudBlazor.ThemeManager/MudBlazorThemeManager.css" rel="stylesheet" /> *@

    <Fluxor.Blazor.Web.StoreInitializer />

    <HeadOutlet />
</head>
<body>
    <svg width="0" height="0" style="position:absolute;left:-9999px;top:-9999px" aria-hidden="true" focusable="false">
        <filter id="pci-liquid-refraction" x="-20%" y="-20%" width="140%" height="140%">
            <feTurbulence type="fractalNoise" baseFrequency="0.008" numOctaves="2" seed="3" result="noise" />
            <feGaussianBlur in="noise" stdDeviation="0.8" result="softNoise" />
            <feDisplacementMap in="SourceGraphic" in2="softNoise" scale="8" xChannelSelector="R" yChannelSelector="G" />
            <feSpecularLighting in="softNoise" surfaceScale="2" specularConstant="0.5" specularExponent="20" lighting-color="white" result="spec">
                <fePointLight x="-200" y="-200" z="300" />
            </feSpecularLighting>
            <feComposite in="SourceGraphic" in2="spec" operator="arithmetic" k1="0" k2="1" k3="0.15" k4="0" />
        </filter>
    </svg>
<CascadingAuthenticationState>
 @*    this is crucial for our Auth to work do not change it  *@
    <Routes @rendermode="InteractiveServer"/>
</CascadingAuthenticationState>

    @*  <HeadOutlet @rendermode="InteractiveServer" /> *@

    <script src="_framework/blazor.web.js"></script>
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>
    <script>
        function downloadFileFromStream(fileName, contentStreamReference) {
            const arrayBuffer = base64ToArrayBuffer(contentStreamReference);
            const blob = new Blob([arrayBuffer]);
            const url = URL.createObjectURL(blob);
            const anchorElement = document.createElement('a');
            anchorElement.href = url;
            anchorElement.download = fileName;
            anchorElement.click();
            anchorElement.remove();
            URL.revokeObjectURL(url);
        }

        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const bytes = new Uint8Array(binaryString.length);
            return bytes.map((byte, i) => binaryString.charCodeAt(i));
        }
    </script>
    <script>

        //         window.authInterop = {
        //     processTokenFragmentAndDispatchEvent: function () {
        //         const fragment = window.location.hash;
        //         let processed = false;
        //         if (fragment && fragment.startsWith("#")) {
        //             const params = new URLSearchParams(fragment.substring(1)); // Remove '#'
        //             const token = params.get("token");
        //             const refreshToken = params.get("refreshToken");

        //             if (token) {
        //                 console.log("JS (authInterop): Storing authToken in localStorage.");
        //                 localStorage.setItem("authToken", token);
        //                 processed = true;
        //             }
        //             if (refreshToken) {
        //                 console.log("JS (authInterop): Storing refreshToken in localStorage.");
        //                 localStorage.setItem("refreshToken", refreshToken);
        //                 processed = true; // Consider it processed if either token is found
        //             }

        //             if (processed) {
        //                 // Clear the fragment from the URL
        //                 console.log("JS (authInterop): Clearing URL fragment.");
        //                 window.history.replaceState(null, document.title, window.location.pathname + window.location.search);

        //                 // Fire a custom event to notify the WASM app
        //                 console.log("JS (authInterop): Dispatching 'authTokensProcessedInLocalStorage' event.");
        //                 window.dispatchEvent(new CustomEvent('authTokensProcessedInLocalStorage', { detail: { tokenStored: !!token } }));
        //             }
        //         }
        //         return processed; // Return true if fragment was found and processed, false otherwise
        //     },

        //     listenForAuthTokensProcessedEvent: function (dotNetHelper) {
        //         console.log("JS (authInterop): Adding event listener for 'authTokensProcessedInLocalStorage'.");
        //         window.addEventListener('authTokensProcessedInLocalStorage', async function (e) {
        //             console.log("JS (authInterop): 'authTokensProcessedInLocalStorage' event caught. Invoking .NET method.");
        //             try {
        //                 await dotNetHelper.invokeMethodAsync('HandleAuthTokensProcessedByJS');
        //             } catch (error) {
        //                 console.error("JS (authInterop): Error invoking .NET method 'HandleAuthTokensProcessedByJS'.", error);
        //             }
        //         });
        //     },

        //     // Optional: if MainLayout needs to get token directly (less ideal than event)
        //     getStoredToken: function() {
        //         return localStorage.getItem("authToken");
        //     }
        // };

    </script>
</body>
</html>